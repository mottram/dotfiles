# File: ~/.zshrc
# Version: 0.3
# Author: Jack Mottram <j@ck.mottr.am>

# General
PATH="/usr/local/bin:/usr/local/sbin:$HOME/bin:$PATH"
if [[ $IS_OSX -eq 1 ]]; then
    export EDITOR=/usr/local/bin/vim
elif [[ $IS_LINUX -eq 1 ]]; then
    export EDITOR=vim
fi

# Source checks, aliases, functions, plugins & prompt
export ZSH_DIR=$HOME/dotfiles/zsh
source $ZSH_DIR/checks.zsh
source $ZSH_DIR/functions.zsh
source $ZSH_DIR/aliases.zsh
source $ZSH_DIR/history.zsh
source $ZSH_DIR/completions.zsh
fpath=($ZSH_DIR/zsh-completions/src $fpath)
fpath=(/usr/local/share/zsh/site-functions $fpath)
source $ZSH_DIR/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets pattern)
source $ZSH_DIR/zsh-history-substring-search/zsh-history-substring-search.zsh
source $ZSH_DIR/opp/opp.zsh
source $ZSH_DIR/opp/opp/*.zsh
source $ZSH_DIR/prompt.zsh

# Vi mode
bindkey -v
autoload -Uz edit-command-line
bindkey -M vicmd 'v' edit-command-line
bindkey -M vicmd '.' insert-last-word
export KEYTIMEOUT=1

# zsh-history-substring-search
zmodload zsh/terminfo
bindkey "$terminfo[kcuu1]" history-substring-search-up
bindkey "$terminfo[kcud1]" history-substring-search-down
bindkey -M vicmd 'k' history-substring-search-up
bindkey -M vicmd 'j' history-substring-search-down

# Change cursor shape according to vi mode in iTerm 2
# | = insert mode
# â–Œ = normal mode
if [[ $IS_OSX -eq 1 ]]; then
    function zle-keymap-select zle-line-init
    {
        case $KEYMAP in
            vicmd)      print -n -- "\E]50;CursorShape=0\C-G";;  # block cursor
            viins|main) print -n -- "\E]50;CursorShape=1\C-G";;  # line cursor
        esac
    
        zle reset-prompt
        zle -R
    }
    
    function zle-line-finish
    {
        print -n -- "\E]50;CursorShape=0\C-G"
    }
    
    zle -N zle-line-init
    zle -N zle-line-finish
    zle -N zle-keymap-select
fi


# RVM and Virtualenv
if [ `hostname` = "mbp" ]; then
    source /usr/local/bin/virtualenvwrapper.sh
    PATH=$PATH:$HOME/.rvm/bin # Add RVM to PATH for scripting
    [[ -s $HOME/.rvm/scripts/rvm ]] && source $HOME/.rvm/scripts/rvm
fi

# pass(1) 
export PASSWORD_STORE_DIR=$HOME/Dropbox/Passwords

